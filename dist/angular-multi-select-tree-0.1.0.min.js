!function(){"use strict";angular.module("multi-select-tree",[])}(),function(){"use strict";var a=angular.module("multi-select-tree");a.controller("multiSelectTreeCtrl",["$scope","$document","$element",function(a,b,c){function d(b){var c=a.getValueContainer().contains(b.target);c||(n(),a.$apply())}function e(){a.disabled||(a.showTree=!0,s||j(),b.on("click",d))}function f(a,b){for(var c=a.children.filter(function(a){return!a.isFiltered}),d=0;d<c.length;d++)b.push(c[d]),c[d].isExpanded&&f(c[d],b);return b}function g(b){for(var c=0;c<a.visibleItems.length;c++)if(b===a.visibleItems[c].id)return c;return-1}function h(b){return a.visibleItems[b]}function i(){return s?g(s.id):-1}function j(){return a.visibleItems.length>0?a.onActiveItem(h(0)):!1}function k(){var b=a.visibleItems.length;return b>0?a.onActiveItem(h(b-1)):!1}function l(){var b=i()+1;return b===a.visibleItems.length?j():a.onActiveItem(h(b))}function m(){var b=i()-1;return-1===b?k():a.onActiveItem(h(b))}function n(){a.showTree=!1,a.filterKeyword="",s&&(s.isActive=!1,s=void 0),b.off("click",d)}function o(b){var c=a.selectedItems?a.selectedItems.length:0,d=c?a.selectedItems[c-1]:void 0;d&&a.deselectItem(d,b)}function p(b){for(var c=0,d=b.length;d>c;c++)q(b[c])||b[c].selected!==!0?q(b[c])&&b[c].selected===!1&&(b[c].selected=!0):a.selectedItems.push(b[c]),b[c]&&b[c].children&&p(b[c].children)}function q(b){var c=!1;if(a.selectedItems)for(var d=0;d<a.selectedItems.length;d++)if(a.selectedItems[d].id===b.id){c=!0;break}return c}function r(b){var c=a.getItemElement(b);if(!c)return!1;var d=a.getPopup(),e=d.getBoundingClientRect(),f=c.getBoundingClientRect(),g=c.offsetHeight/3;if(f.bottom+g>e.bottom){var h=Math.min(c.offsetTop+c.clientHeight-d.offsetHeight+g,d.scrollHeight);d.scrollTop=h}else f.top-g<e.top&&(d.scrollTop=Math.max(c.offsetTop-g,0))}var s,t={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46},u=[t.ENTER,t.END,t.HOME,t.ARROW_LEFT,t.ARROW_UP,t.ARROW_RIGHT,t.ARROW_DOWN];a.showTree=!1,a.selectedItems=[],a.visibleItems=[],a.multiSelect=a.multiSelect||!1,a.filterKeyword="",a.onActiveItem=function(a){s!==a&&(s&&(s.isActive=!1),s=a,s.isActive=!0),r(s)},a.itemExpandToggle=function(b){b.isExpanded=!b.isExpanded,this.focusInput(),a.resetVisibleNodes()},a.refreshOutputModel=function(){a.outputModel=angular.copy(a.selectedItems)},a.refreshSelectedItems=function(){a.selectedItems=[],a.inputModel&&p(a.inputModel)},a.deselectItem=function(b,c){c.stopPropagation(),a.disabled||(a.selectedItems.splice(a.selectedItems.indexOf(b),1),b.selected=!1,this.refreshOutputModel())},a.clearSelection=function(b){b.stopPropagation(),a.disabled||(angular.forEach(a.selectedItems,function(a){a.selected=!1}),a.selectedItems=[],a.refreshOutputModel())},a.getItemElement=function(a){return c[0].querySelector('.multi-select-tree__option[data-id="'+a.id+'"]')},a.getPopup=function(){return c[0].querySelector(".multi-select-tree__popup")},a.getValueContainer=function(){return c[0].querySelector(".multi-select-tree__value-container")},a.onInputBlur=function(b){a.isInputFocused=!1},a.onInputKeydown=function(b){var c="which"in b?b.which:b.keyCode;if(!(b.ctrlKey||b.shiftKey||b.altKey||b.metaKey)){if(!a.showTree&&-1!==u.indexOf(c))return b.preventDefault(),void e();switch(c){case t.TAB:n();break;case t.ESCAPE:a.filterKeyword&&a.filterKeyword.length>0?a.clearFilter(b):a.showTree&&n();break;case t.BACKSPACE:0===a.filterKeyword.length&&o(b);break;case t.ARROW_LEFT:if(b.preventDefault(),s.isExpanded)a.itemExpandToggle(s);else if(s.parent_id){var d=h(g(s.parent_id));a.itemExpandToggle(d),a.onActiveItem(d)}break;case t.ARROW_UP:b.preventDefault(),m();break;case t.ARROW_RIGHT:b.preventDefault(),!s.isExpanded&&s.children&&s.children.length>0&&a.itemExpandToggle(s);break;case t.ARROW_DOWN:b.preventDefault(),l();break;case t.ENTER:b.preventDefault(),s&&a.itemSelected(s);break;case t.HOME:b.preventDefault(),j();break;case t.END:b.preventDefault(),k();break;default:a.showTree||e()}}},a.getInput=function(){return this.getValueContainer().querySelector(".multi-select-tree__input")},a.focusInput=function(){a.isInputFocused=!0,this.getInput().focus()},a.onControlClick=function(b){if(b.preventDefault(),b.stopPropagation(),!a.disabled){var c=a.getValueContainer().contains(b.target);c&&!a.showTree&&e(),this.focusInput()}},a.togglePopup=function(b){b.preventDefault(),b.stopPropagation(),a.disabled||(a.showTree?n():e())},a.onFilterClicked=function(a){a.stopPropagation()},a.clearFilter=function(b){b.stopPropagation(),a.filterKeyword=""},a.canSelectItem=function(b){return a.callback({item:b,selectedItems:a.selectedItems})},a.itemSelected=function(b){if(a.useCallback&&a.canSelectItem(b)===!1||a.selectOnlyLeafs&&b.children&&b.children.length>0)return void a.itemExpandToggle(b);if(a.multiSelect){b.selected=!0;var c=a.selectedItems.indexOf(b);q(b)?(b.selected=!1,a.selectedItems.splice(c,1)):a.selectedItems.push(b)}else{n();for(var d=0;d<a.selectedItems.length;d++)a.selectedItems[d].selected=!1;b.selected=!0,a.selectedItems=[],a.selectedItems.push(b)}this.focusInput(),this.refreshOutputModel()},a.resetVisibleNodes=function(){a.visibleItems=f({children:a.inputModel},[])}}]),a.directive("multiSelectTree",function(){return{restrict:"E",templateUrl:"src/multi-select-tree.tpl.html",scope:{inputModel:"=",outputModel:"=?",multiSelect:"=?",selectOnlyLeafs:"=?",callback:"&",defaultLabel:"@",noResultsText:"@"},link:function(a,b,c){function d(a,b){for(var c=a.children||[],e=0,f=0,g=c.length;g>f;f++)c[f].isFiltered=b.length>0,d(c[f],b)&&-1===c[f].name.toLowerCase().indexOf(b.toLowerCase())||(c[f].isFiltered=!1,c[f].isExpanded=!0,e++);return 0===e}c.callback&&(a.useCallback=!0),"undefined"!=typeof c.disabled&&(a.disabled=!0),a.$watch("inputModel",function(b){b&&(a.refreshSelectedItems(),a.refreshOutputModel())}),a.$watch("filterKeyword",function(){a.totalFilteredItems=0,void 0!==a.filterKeyword&&angular.forEach(a.inputModel,function(b){b.isExpanded=!1,d(b,a.filterKeyword)&&-1===b.name.toLowerCase().indexOf(a.filterKeyword.toLowerCase())?b.isFiltered=!0:b.isFiltered=!1,b.isFiltered||(a.totalFilteredItems++,b.isExpanded=a.filterKeyword.length>0)}),a.resetVisibleNodes()})},controller:"multiSelectTreeCtrl"}})}(),function(){"use strict";var a=angular.module("multi-select-tree");a.controller("treeItemCtrl",["$scope",function(a){"boolean"!=typeof a.item.isExpanded&&(a.item.isExpanded=!1),a.parentItem&&(a.item.parent_id=a.parentItem.id),a.showExpand=function(a){return a.children&&a.children.length>0},a.onExpandClicked=function(b,c){c.stopPropagation(),a.expandToggle&&a.expandToggle({item:b})},a.onSubItemExpandClicked=function(b,c){a.expandToggle&&a.expandToggle({item:b})},a.clickSelectItem=function(b,c){c.stopPropagation(),a.itemSelected&&a.itemSelected({item:b})},a.subItemSelected=function(b,c){a.itemSelected&&a.itemSelected({item:b})},a.activeSubItem=function(b,c){a.onActiveItem&&a.onActiveItem({item:b})},a.onMouseOver=function(b,c){c.stopPropagation(),a.onActiveItem&&a.onActiveItem({item:b})},a.showCheckbox=function(){return a.multiSelect?a.selectOnlyLeafs?!1:a.useCallback?a.canSelectItem(a.item):!0:!1}}]),a.directive("treeItem",["$compile",function(a){return{restrict:"E",templateUrl:"src/tree-item.tpl.html",scope:{item:"=",parentItem:"=",itemSelected:"&",onActiveItem:"&",expandToggle:"&",multiSelect:"=?",selectOnlyLeafs:"=?",isActive:"=",useCallback:"=",canSelectItem:"="},controller:"treeItemCtrl",compile:function(b,c,d){angular.isFunction(d)&&(d={post:d});var e,f=b.contents().remove();return{pre:d&&d.pre?d.pre:null,post:function(b,c,g){e||(e=a(f)),e(b,function(a){c.append(a)}),d&&d.post&&d.post.apply(null,arguments)}}}}}])}();