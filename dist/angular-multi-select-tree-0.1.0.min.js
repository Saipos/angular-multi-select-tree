!function(){"use strict";angular.module("multi-select-tree",[])}(),function(){"use strict";var a=angular.module("multi-select-tree");a.controller("multiSelectTreeCtrl",["$scope","$document","$element",function(a,b,c){function d(b){var c=a.getValueContainer().contains(b.target);c||(a.closePopup(),a.$apply())}function e(a,b){for(var c=a.children.filter(function(a){return!a.isFiltered}),d=0;d<c.length;d++)b.push(c[d]),c[d].isExpanded&&e(c[d],b);return b}function f(b){for(var c=0,d=b.length;d>c;c++)g(b[c])||b[c].selected!==!0?g(b[c])&&b[c].selected===!1&&(b[c].selected=!0):a.selectedItems.push(b[c]),b[c]&&b[c].children&&f(b[c].children)}function g(b){var c=!1;if(a.selectedItems)for(var d=0;d<a.selectedItems.length;d++)if(a.selectedItems[d].id===b.id){c=!0;break}return c}function h(b){var c=a.getItemElement(b);if(!c)return!1;var d=a.getPopup(),e=d.getBoundingClientRect(),f=c.getBoundingClientRect(),g=c.offsetHeight/3;if(f.bottom+g>e.bottom){var h=Math.min(c.offsetTop+c.clientHeight-d.offsetHeight+g,d.scrollHeight);d.scrollTop=h}else f.top-g<e.top&&(d.scrollTop=Math.max(c.offsetTop-g,0))}function i(b){a.popupPlacement=b}a.showTree=!1,a.selectedItems=[],a.visibleItems=[],a.multiSelect=a.multiSelect||!1,a.filterKeyword="",a.activeItem=null,a.popupPlacement="below",a.openPopup=function(){a.disabled||(a.showTree=!0,a.activeItem||a.activeFirstItem(),b.on("click",d))},a.closePopup=function(){a.showTree=!1,a.filterKeyword="",a.activeItem&&(a.activeItem.isActive=!1,a.activeItem=void 0),b.off("click",d)},a.getItemIndex=function(b){for(var c=0;c<a.visibleItems.length;c++)if(b===a.visibleItems[c].id)return c;return-1},a.getActiveItemIndex=function(){return a.activeItem?a.getItemIndex(a.activeItem.id):-1},a.getItemAt=function(b){return a.visibleItems[b]},a.activeFirstItem=function(){return a.visibleItems.length>0?a.onActiveItem(a.getItemAt(0)):!1},a.activeLastItem=function(){var b=a.visibleItems.length;return b>0?a.onActiveItem(a.getItemAt(b-1)):!1},a.activeNextItem=function(){var b=a.getActiveItemIndex()+1;return b===a.visibleItems.length?a.activeFirstItem():a.onActiveItem(a.getItemAt(b))},a.activePreviousItem=function(){var b=a.getActiveItemIndex()-1;return-1===b?a.activeLastItem():a.onActiveItem(a.getItemAt(b))},a.removeLastSelected=function(){var b=a.selectedItems?a.selectedItems.length:0,c=b?a.selectedItems[b-1]:void 0;c&&a.deselectItem(c)},a.onActiveItem=function(b){a.activeItem!==b&&(a.activeItem&&(a.activeItem.isActive=!1),a.activeItem=b,a.activeItem.isActive=!0),h(a.activeItem)},a.itemExpandToggle=function(b){b.isExpanded=!b.isExpanded,this.focusInput(),a.resetVisibleNodes()},a.refreshOutputModel=function(){a.outputModel=angular.copy(a.selectedItems)},a.refreshSelectedItems=function(){a.selectedItems=[],a.inputModel&&f(a.inputModel)},a.deselectItem=function(b){a.disabled||(a.selectedItems.splice(a.selectedItems.indexOf(b),1),b.selected=!1,this.refreshOutputModel())},a.clearSelection=function(b){b.stopPropagation(),a.disabled||(angular.forEach(a.selectedItems,function(a){a.selected=!1}),a.selectedItems=[],a.refreshOutputModel())},a.getItemElement=function(a){return c[0].querySelector('.multi-select-tree__option[data-id="'+a.id+'"]')},a.getPopup=function(){return c[0].querySelector(".multi-select-tree__popup")},a.getControl=function(){return c[0].querySelector(".multi-select-tree__control")},a.getValueContainer=function(){return c[0].querySelector(".multi-select-tree__value-container")},a.onInputBlur=function(b){a.isInputFocused=!1},a.getInput=function(){return this.getValueContainer().querySelector(".multi-select-tree__input")},a.focusInput=function(){a.isInputFocused=!0,this.getInput().focus()},a.togglePopup=function(b){b.preventDefault(),b.stopPropagation(),a.disabled||(a.showTree?a.closePopup():a.openPopup(),this.focusInput())},a.onFilterClicked=function(a){a.stopPropagation()},a.clearFilter=function(){a.filterKeyword=""},a.canSelectItem=function(b){return a.callback({item:b,selectedItems:a.selectedItems})},a.itemSelected=function(b){if(a.useCallback&&a.canSelectItem(b)===!1||a.selectOnlyLeafs&&b.children&&b.children.length>0)return void a.itemExpandToggle(b);if(a.multiSelect){b.selected=!0;var c=a.selectedItems.indexOf(b);g(b)?(b.selected=!1,a.selectedItems.splice(c,1)):a.selectedItems.push(b)}else{a.closePopup();for(var d=0;d<a.selectedItems.length;d++)a.selectedItems[d].selected=!1;b.selected=!0,a.selectedItems=[],a.selectedItems.push(b)}this.focusInput(),this.refreshOutputModel()},a.resetVisibleNodes=function(){a.visibleItems=e({children:a.inputModel},[])},a.setPopupAbove=function(){i("above")},a.setPopupBelow=function(){i("below")}}]),a.directive("multiSelectTree",function(){return{restrict:"E",templateUrl:"src/multi-select-tree.tpl.html",scope:{inputModel:"=",outputModel:"=?",multiSelect:"=?",selectOnlyLeafs:"=?",callback:"&",defaultLabel:"@",noResultsText:"@"},link:function(a,b,c){function d(a,b){for(var c=a.children||[],e=0,f=0,g=c.length;g>f;f++)c[f].isFiltered=b.length>0,d(c[f],b)&&-1===c[f].name.toLowerCase().indexOf(b.toLowerCase())||(c[f].isFiltered=!1,c[f].isExpanded=b.length>0,e++);return 0===e}c.callback&&(a.useCallback=!0),"undefined"!=typeof c.disabled&&(a.disabled=!0),a.$watch("inputModel",function(b){b&&(a.refreshSelectedItems(),a.refreshOutputModel())}),a.$watch("filterKeyword",function(){a.totalFilteredItems=0,void 0!==a.filterKeyword&&angular.forEach(a.inputModel,function(b){b.isExpanded=!1,d(b,a.filterKeyword)&&-1===b.name.toLowerCase().indexOf(a.filterKeyword.toLowerCase())?b.isFiltered=!0:b.isFiltered=!1,b.isFiltered||(a.totalFilteredItems++,b.isExpanded=a.filterKeyword.length>0)}),a.resetVisibleNodes()})},controller:"multiSelectTreeCtrl"}})}(),function(){"use strict";var a=angular.module("multi-select-tree");a.controller("multiValueItemCtrl",["$scope",function(a){a.onClick=function(b){b.preventDefault(),b.stopPropagation(),a.instance.deselectItem(a.item)}}]),a.directive("multiValueItem",function(){return{restrict:"E",templateUrl:"src/multi-value-item.tpl.html",controller:"multiValueItemCtrl",scope:{instance:"=",item:"="}}})}(),function(){"use strict";var a=angular.module("multi-select-tree");a.directive("singleValue",function(){return{restrict:"E",templateUrl:"src/single-value.tpl.html",scope:{instance:"=",item:"="}}})}(),function(){"use strict";var a=angular.module("multi-select-tree");a.controller("treeControlCtrl",["$scope",function(a){a.onClick=function(b){if(b.preventDefault(),b.stopPropagation(),!a.instance.disabled){var c=a.instance.getValueContainer().contains(b.target);c&&!a.instance.showTree&&a.instance.openPopup(),a.instance.focusInput()}}}]),a.directive("treeControl",function(){return{restrict:"E",templateUrl:"src/tree-control.tpl.html",controller:"treeControlCtrl",scope:{instance:"="}}})}(),function(){"use strict";var a=angular.module("multi-select-tree");a.controller("treeFilterInputCtrl",["$scope",function(a){var b={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46},c=[b.ENTER,b.END,b.HOME,b.ARROW_LEFT,b.ARROW_UP,b.ARROW_RIGHT,b.ARROW_DOWN];a.onBlur=function(b){b.preventDefault(),b.stopPropagation(),a.instance.onInputBlur(b)},a.onKeydown=function(d){var e="which"in d?d.which:d.keyCode;if(!(d.ctrlKey||d.shiftKey||d.altKey||d.metaKey)){if(!a.instance.showTree&&-1!==c.indexOf(e))return d.preventDefault(),void a.instance.openPopup();switch(e){case b.TAB:a.instance.closePopup();break;case b.ESCAPE:a.instance.filterKeyword&&a.instance.filterKeyword.length>0?a.instance.clearFilter():a.instance.showTree&&a.instance.closePopup();break;case b.BACKSPACE:0===a.instance.getInput().value.length&&(d.preventDefault(),a.instance.removeLastSelected());break;case b.ARROW_LEFT:if(d.preventDefault(),a.instance.activeItem&&a.instance.activeItem.isExpanded)a.instance.itemExpandToggle(a.instance.activeItem);else if(a.instance.activeItem&&a.instance.activeItem.parent_id){var f=a.instance.getItemAt(a.instance.getItemIndex(a.instance.activeItem.parent_id));a.instance.itemExpandToggle(f),a.instance.onActiveItem(f)}break;case b.ARROW_UP:d.preventDefault(),a.instance.activePreviousItem();break;case b.ARROW_RIGHT:d.preventDefault(),!a.instance.activeItem.isExpanded&&a.instance.activeItem.children&&a.instance.activeItem.children.length>0&&a.instance.itemExpandToggle(a.instance.activeItem);break;case b.ARROW_DOWN:d.preventDefault(),a.instance.activeNextItem();break;case b.ENTER:d.preventDefault(),a.instance.activeItem&&a.instance.itemSelected(a.instance.activeItem);break;case b.HOME:d.preventDefault(),a.instance.activeFirstItem();break;case b.END:d.preventDefault(),a.instance.activeLastItem();break;default:a.instance.showTree||a.instance.openPopup()}}}}]),a.directive("treeFilterInput",function(){return{restrict:"E",templateUrl:"src/tree-filter-input.tpl.html",controller:"treeFilterInputCtrl",scope:{instance:"="}}})}(),function(){"use strict";var a=angular.module("multi-select-tree");a.controller("treeItemCtrl",["$scope",function(a){"boolean"!=typeof a.item.isExpanded&&(a.item.isExpanded=!1),a.parentItem&&(a.item.parent_id=a.parentItem.id),a.showExpand=function(a){return a.children&&a.children.length>0},a.onExpandClicked=function(b,c){c.stopPropagation(),a.expandToggle&&a.expandToggle({item:b})},a.onSubItemExpandClicked=function(b,c){a.expandToggle&&a.expandToggle({item:b})},a.clickSelectItem=function(b,c){c.stopPropagation(),a.itemSelected&&a.itemSelected({item:b})},a.subItemSelected=function(b,c){a.itemSelected&&a.itemSelected({item:b})},a.activeSubItem=function(b,c){a.onActiveItem&&a.onActiveItem({item:b})},a.onMouseOver=function(b,c){c.stopPropagation(),a.onActiveItem&&a.onActiveItem({item:b})},a.showCheckbox=function(){return a.multiSelect?a.selectOnlyLeafs?!1:a.useCallback?a.canSelectItem(a.item):!0:!1}}]),a.directive("treeItem",["$compile",function(a){return{restrict:"E",templateUrl:"src/tree-item.tpl.html",scope:{item:"=",parentItem:"=",itemSelected:"&",onActiveItem:"&",expandToggle:"&",multiSelect:"=?",selectOnlyLeafs:"=?",isActive:"=",useCallback:"=",canSelectItem:"="},controller:"treeItemCtrl",compile:function(b,c,d){angular.isFunction(d)&&(d={post:d});var e,f=b.contents().remove();return{pre:d&&d.pre?d.pre:null,post:function(b,c,g){e||(e=a(f)),e(b,function(a){c.append(a)}),d&&d.post&&d.post.apply(null,arguments)}}}}}])}(),function(){"use strict";var a=angular.module("multi-select-tree");a.controller("treePopupCtrl",["$scope","$timeout","$window",function(a,b,c){function d(a){for(var b=[],c=a.parentNode;c&&"BODY"!==c.nodeName&&c.nodeType===document.ELEMENT_NODE;)e(c)&&b.push(c),c=c.parentNode;return b.push(window),b}function e(a){var b=getComputedStyle(a);return/(auto|scroll|overlay)/.test(b.overflow+b.overflowY+b.overflowX)}function f(){if(a.instance.showTree){var b=a.instance.getPopup(),d=a.instance.getControl(),e=b.getBoundingClientRect(),f=d.getBoundingClientRect(),g=f.top,h=c.innerHeight-f.bottom,i=f.top>=0&&f.top<=c.innerHeight||f.top<0&&f.bottom>0,j=h>e.height,k=g>e.height;i?j||!k?a.instance.setPopupBelow():a.instance.setPopupAbove():a.instance.closePopup(),a.$apply()}}a.$watch("instance.showTree",function(){b(function(){f()})}),a.setupResizeAndScrollEventListeners=function(){var b=d(a.instance.getPopup());return c.addEventListener("resize",f),b.forEach(function(a){a.addEventListener("scroll",f,{passive:!0})}),function(){c.removeEventListener("resize",f,{passive:!0}),b.forEach(function(a){a.removeEventListener("scroll",f,{passive:!0})})}}}]),a.directive("treePopup",function(){return{restrict:"E",templateUrl:"src/tree-popup.tpl.html",scope:{instance:"="},controller:"treePopupCtrl",link:function(a){var b={destroy:a.setupResizeAndScrollEventListeners()};a.$on("$destroy",function(){b.destroy()})}}})}();